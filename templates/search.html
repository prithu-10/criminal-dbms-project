{% extends "base.html" %}

{% block title %}Search Records{% endblock %}

{% block content %}
<div class="page-header">
    <h2 class="page-title">
        <svg class="nav-icon" viewBox="0 0 24 24" fill="currentColor">
            <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
        </svg>
        Search Records
    </h2>
</div>

<div class="card">
    <div class="card-header">
        Search Query
    </div>
    <div class="card-body">
        <form method="POST">
            <div class="row">
                <div class="col-md-5 mb-3">
                    <label for="search_type" class="form-label">Search Type</label>
                    <select class="form-select" id="search_type" name="search_type" required>
                        <option value="">Select Search Type</option>
                        <option value="criminal" {% if search_type == 'criminal' %}selected{% endif %}>Criminal</option>
                        <option value="case" {% if search_type == 'case' %}selected{% endif %}>Case</option>
                    </select>
                </div>
                <div class="col-md-5 mb-3">
                    <label for="query" class="form-label">Search Term</label>
                    <input type="text" class="form-control" id="query" name="query" value="{{ query }}" placeholder="Enter name, ID, or case title..." required>
                </div>
                <div class="col-md-2 mb-3 d-flex align-items-end">
                    <button type="submit" class="action-btn search w-100">
                        <svg class="btn-icon" viewBox="0 0 24 24"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>
                        Search
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>

{% if request.method == 'POST' %}
<div class="card mt-4">
    <div class="card-header">
        Search Results
    </div>
    <div class="card-body">
        {% if results %}
            {% if search_type == 'criminal' %}
            <div class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Name</th>
                            <th>National ID</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for result in results %}
                        <tr>
                            <td>{{ result.criminalid }}</td>
                            <td>{{ result.firstname }} {{ result.lastname }}</td>
                            <td>{{ result.nationalid }}</td>
                            <td>{{ result.status }}</td>
                            <td>
                                <a href="{{ url_for('edit_criminal', criminal_id=result.criminalid) }}" class="btn btn-warning btn-sm">Edit</a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% elif search_type == 'case' %}
            <div class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead>
                        <tr>
                            <th>Case ID</th>
                            <th>Title</th>
                            <th>Date Reported</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for result in results %}
                        <tr>
                            <td>{{ result.caseid }}</td>
                            <td>{{ result.casetitle }}</td>
                            <td>{{ result.datereported.strftime('%Y-%m-%d') }}</td>
                            <td>{{ result.status }}</td>
                            <td>
                                <a href="{{ url_for('edit_case', case_id=result.caseid) }}" class="btn btn-warning btn-sm">Edit</a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% endif %}
        {% else %}
            <p class="text-center text-muted m-3">No results found for '{{ query }}' in {{ search_type }}s.</p>
        {% endif %}
    </div>
</div>
{% endif %}

{% endblock %}